<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spotify-GuessWho!</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css">
    <style>
        body {
            background: linear-gradient(135deg, #232526 0%, #414345 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Arial, sans-serif;
        }
        .game-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
        }
        .game-card {
            background: #fff;
            border-radius: 20px;
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.15);
            padding: 36px 32px 32px 32px;
            max-width: 420px;
            width: 100%;
            margin-bottom: 32px;
            text-align: center;
            position: relative;
        }
        .song-art {
            width: 120px;
            height: 120px;
            border-radius: 12px;
            box-shadow: 0 2px 12px rgba(91,134,229,0.12);
            margin-bottom: 18px;
            object-fit: cover;
        }
        .song-title {
            font-size: 1.3rem;
            font-weight: 700;
            color: #232526;
        }
        .song-artist {
            font-size: 1.1rem;
            color: #5b86e5;
            margin-bottom: 8px;
        }
        .main-btn {
            width: 100%;
            margin-bottom: 18px;
            font-size: 1.1rem;
            font-weight: 500;
            border-radius: 8px;
            background: linear-gradient(90deg, #36d1c4 0%, #5b86e5 100%);
            color: #fff;
            border: none;
            transition: background 0.2s, box-shadow 0.2s;
            box-shadow: 0 2px 8px rgba(91,134,229,0.08);
        }
        .main-btn:hover, .main-btn:focus {
            background: linear-gradient(90deg, #5b86e5 0%, #36d1c4 100%);
            color: #fff;
        }
        .guess-feedback {
            min-height: 32px;
            margin-bottom: 10px;
            font-size: 1.08rem;
            transition: color 0.2s;
        }
        .score-box {
            background: linear-gradient(90deg, #36d1c4 0%, #5b86e5 100%);
            color: #fff;
            border-radius: 8px;
            padding: 8px 0;
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 18px;
        }
        .leaderboard-card {
            background: #f8f9fa;
            border-radius: 16px;
            box-shadow: 0 2px 8px rgba(91,134,229,0.06);
            padding: 24px 20px 18px 20px;
            max-width: 340px;
            width: 100%;
            margin: 0 auto;
        }
        .leaderboard-title {
            font-size: 1.15rem;
            font-weight: 700;
            color: #232526;
            margin-bottom: 12px;
        }
        .list-group-item {
            background: transparent;
            border: none;
            font-size: 1.05rem;
        }
        @media (max-width: 600px) {
            .game-card, .leaderboard-card {
                max-width: 98vw;
                padding: 18px 6vw 18px 6vw;
            }
        }
    </style>
</head>
<body>
<div class="game-wrapper">
    <div class="game-card">
        <h2 class="mb-3">Spotify-GuessWho!</h2>
        {% if song %}
        <div id="current-song-container">
            {% if song.album_image %}
                <img src="{{ song.album_image }}" alt="Album Art" class="song-art mb-2">
            {% endif %}
            <div class="song-title">{{ song.name }}</div>
            <div class="song-artist">by {{ song.artist }}</div>
            <a href="{{ song.url }}" target="_blank" style="font-size:0.98rem;">Open in Spotify</a>
        </div>
        <form method="POST" action="{{ url_for('guess_song') }}" class="mt-3" id="guess-form">
            <label for="guess_user" class="form-label mb-1">Who added this song?</label>
            <select id="guess_user" name="guess_user" class="form-select mb-3" required>
                {% for user in users %}
                    <option value="{{ user }}">{{ user }}</option>
                {% endfor %}
            </select>
            <button type="submit" class="main-btn">Submit Guess</button>
        </form>
        <div id="guess-feedback"></div>
        {% else %}
        <div class="alert alert-warning mt-3">No song currently playing.</div>
        {% endif %}
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            <div class="mt-3">
              {% for category, message in messages %}
                <div class="alert alert-{{ category }}">{{ message }}</div>
              {% endfor %}
            </div>
          {% endif %}
        {% endwith %}
    </div>
    <div class="leaderboard-card">
        <div class="leaderboard-title">Leaderboard</div>
        <ul id="leaderboard-list" class="list-group">
            <!-- Leaderboard will be loaded here by JS -->
        </ul>
    </div>
</div>
<script>
    // --- Real-time song and leaderboard update ---
    function fetchGameState() {
        fetch('/current-song').then(r => r.json()).then(data => {
            if (data && data.name) {
                document.querySelector('.song-title').textContent = data.name;
                document.querySelector('.song-artist').textContent = 'by ' + data.artist;
                document.querySelector('.song-art').src = data.album_image || '';
                document.querySelector('.song-art').style.display = data.album_image ? '' : 'none';
                document.querySelector('.song-title').parentElement.querySelector('a').href = data.url;
                // Update guess options
                let guessUser = document.getElementById('guess_user');
                if (guessUser) {
                    guessUser.innerHTML = (data.added_by || []).map(u => `<option value="${u}">${u}</option>`).join('');
                }
            }
        });
        fetch('/leaderboard').then(r => r.json()).then(data => {
            let html = '';
            data.forEach(function(entry, idx) {
                html += `<li class="list-group-item d-flex justify-content-between align-items-center">
                    <span>${idx+1}. ${entry[0]}</span>
                    <span class="badge bg-primary rounded-pill">${entry[1]}</span>
                </li>`;
            });
            document.getElementById('leaderboard-list').innerHTML = html;
        });
    }
    setInterval(fetchGameState, 3000);
    fetchGameState();
</script>
</body>
</html>
